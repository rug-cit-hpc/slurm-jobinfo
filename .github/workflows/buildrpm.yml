name: Build RPM

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v2

      - name: create tarball
        shell: bash
        run: |
          version="$(grep Version jobinfo.spec | awk '{print $2}')"
          mkdir SOURCES
          mkdir SPECS
          cp jobinfo.spec SPECS
          mkdir jobinfo-${version}
          cp jobinfo pynumparser.py jobinfo-${version}
          tar -czf SOURCES/jobinfo-${version}.tar.gz jobinfo-${version}

      - name: rpmbuild
        uses: ./.github/actions/rpmbuild-centos7/

      - name: upload rpm package as artifact
        uses: actions/upload-artifact@v2
        with:
          name: RPM package
          path: ${{ github.workspace }}/noarch/jobinfo*.rpm
